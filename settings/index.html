<!doctype html>
<html>
    <head>
        <script type="text/javascript" src="/homey.js" data-origin="settings"></script>

    </head>
    <body>

        <h1 data-i18n="settings.title">
        </h1>
        <p data-i18n="settings.subtitle"/>

        <fieldset>
            <legend>Settings</legend>

            <div class="field row">
                <label for="username" data-i18n="settings.username">:</label>
                <input id="username" type="text" value="" />
            </div>
            <div class="field row">
                <label for="password" data-i18n="settings.password">:</label>
                <input id="password" type="password" value="" />
            </div>

            <div class="field row">
                <label for="secret" data-i18n="settings.secret"/>:</label>
                <input id="secret" type="text" value="" readonly/>
            </div>

        </fieldset>

        <button id="save" class="right">Save changes</button>

        <script type="text/javascript">

        function onHomeyReady( Homey ){

            Homey.ready();

            var usernameElement = document.getElementById('username');
            var passwordElement = document.getElementById('password');
            var secretElement = document.getElementById('secret');
            var saveElement = document.getElementById('save');

            Homey.get('x-picnic-auth', function( err, secret ) {
               if( err ) return Homey.alert( err );
               secretElement.value = secret;
            });

            saveElement.addEventListener('click', function(e) {

              Homey.api('POST', '/login', { 'username': usernameElement.value, 'password': passwordElement.value }, function( err, result ) {
                if( err ) return Homey.alert(err);
              });

            });
        }
        </script>

    </body>
</html>
